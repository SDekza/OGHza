<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <!-- เพิ่ม viewport-fit=cover เพื่อให้เต็มจอ iPhone และป้องกันการซูมมั่ว -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CNX 2026 Trip Planner</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #f8fafc;
            /* ป้องกันการเด้งของหน้าจอใน iOS */
            overscroll-behavior-y: none;
        }

        /* จัดการ Safe Area ของ iPhone (ติ่งหน้าจอ และ ขีด Home ด้านล่าง) */
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        #error-display {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #fee2e2;
            color: #991b1b;
            padding: 2rem;
            z-index: 9999;
            white-space: pre-wrap;
            font-family: monospace;
            overflow: auto;
        }
    </style>
</head>
<body>
    <!-- พื้นที่แสดง Error (ถ้ามี) -->
    <div id="error-display"></div>

    <!-- ส่วน Loading ก่อน React มา -->
    <div id="root" class="min-h-screen flex items-center justify-center bg-slate-50 text-slate-400 font-bold safe-top safe-bottom">
        <div class="text-center animate-pulse">
            <p>Loading CNX Trip...</p>
        </div>
    </div>

    <script>
        // ดักจับ Error ทั้งหมดแล้วแสดงบนหน้าจอ
        window.onerror = function(message, source, lineno, colno, error) {
            const display = document.getElementById('error-display');
            display.style.display = 'block';
            display.innerHTML = `<strong>⚠️ เกิดข้อผิดพลาด:</strong>\n${message}\n\nที่ไฟล์: ${source}\nบรรทัด: ${lineno}`;
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICON COMPONENTS (SVG ฝังในไฟล์ เพื่อความชัวร์ 100%) ---
        const Icon = ({ children, className, size = 24, onClick }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                onClick={onClick}
            >
                {children}
            </svg>
        );

        const PlaneIcon = (props) => <Icon {...props}><path d="M2 22h20"/><path d="M22 2 2 22"/><path d="M2 2 22 22" opacity="0"/><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.2-1.1.7l-1.2 4 6 3.2-2 2-4-1.5L1 16l7.4 1.6c.7.1 1.4-.1 1.9-.4l4.1-3.2 2.4 4.3c.3.4.7.7 1.1.8l.8.2.1-1.1z"/></Icon>;
        const CarIcon = (props) => <Icon {...props}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></Icon>;
        const UtensilsIcon = (props) => <Icon {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></Icon>;
        const CoffeeIcon = (props) => <Icon {...props}><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></Icon>;
        const CameraIcon = (props) => <Icon {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Icon>;
        const HomeIcon = (props) => <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const MapPinIcon = (props) => <Icon {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>;
        const PlusIcon = (props) => <Icon {...props}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const Trash2Icon = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
        const MoonIcon = (props) => <Icon {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></Icon>;
        const SunIcon = (props) => <Icon {...props}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></Icon>;
        const LeafIcon = (props) => <Icon {...props}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 6.5-2 11a7 7 0 0 1-6 7z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></Icon>;
        const FuelIcon = (props) => <Icon {...props}><line x1="3" x2="15" y1="22" y2="22"/><line x1="4" x2="14" y1="9" y2="9"/><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"/></Icon>;
        const SaveIcon = (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
        const NavigationIcon = (props) => <Icon {...props}><polygon points="3 11 22 2 13 21 11 13 3 11"/></Icon>;
        const ChevronRightIcon = (props) => <Icon {...props}><path d="m9 18 6-6-6-6"/></Icon>;

        // --- APP MAIN ---
        const App = () => {
            const [theme, setTheme] = useState('muji');
            const [gasTotal, setGasTotal] = useState(0);
            const [showGasInput, setShowGasInput] = useState(false);
            const [tempGas, setTempGas] = useState('');
            const [flightCost, setFlightCost] = useState(0);
            const [isEditingFlight, setIsEditingFlight] = useState(false);

            const handleAddGas = () => {
                if (tempGas && !isNaN(tempGas)) {
                    setGasTotal(prev => prev + parseFloat(tempGas));
                    setTempGas('');
                    setShowGasInput(false);
                }
            };

            const itinerary = [
                {
                    date: '4 Feb 2026',
                    title: 'Day 1: มุ่งสู่ม่อนแจ่ม (อัปเดตใหม่)',
                    items: [
                        { time: '11:10', activity: 'ถึงสนามบินเชียงใหม่ (CNX)', icon: <PlaneIcon className="text-blue-500" />, location: 'Terminal 1', link: 'https://maps.google.com/?q=Chiang+Mai+International+Airport' },
                        { time: '11:45', activity: 'รับรถเช่าที่จองไว้', icon: <CarIcon className="text-slate-500" />, location: 'Counter Car Rental', link: '' },
                        { time: '12:15', activity: 'ทานมื้อเที่ยง (เน้นเร็ว)', icon: <UtensilsIcon className="text-orange-500" />, location: 'ร้านอาหารใกล้สนามบิน', link: 'https://maps.google.com/?q=Restaurants+near+CNX' },
                        { time: '13:30', activity: 'Cafe Hopping (แม่ริม)', icon: <CoffeeIcon className="text-yellow-700" />, location: 'Chic 39 / WTF Coffee Camp', link: 'https://maps.google.com/?q=Chic+39+Chiang+Mai' },
                        { time: '15:00', activity: 'เช็คอินที่พัก', icon: <HomeIcon className="text-green-600" />, location: 'ม่อนลมหนาว โฮมสเตย์', link: 'https://maps.google.com/?q=ม่อนลมหนาว+โฮมสเตย์' },
                        { time: '16:30', activity: 'ชมวิวพระอาทิตย์ตก', icon: <CameraIcon className="text-purple-500" />, location: 'ยิ่งยงสวนดอกไม้', link: 'https://maps.google.com/?q=ยิ่งยงสวนดอกไม้' },
                        { time: '18:30', activity: 'มื้อค่ำ: หมูกระทะ', icon: <UtensilsIcon className="text-red-500" />, location: 'หน้าห้องพัก (ม่อนลมหนาว)', link: '' },
                    ]
                }
            ];

            const themes = {
                light: 'bg-slate-50 text-slate-900',
                dark: 'bg-slate-900 text-slate-100',
                muji: 'bg-[#F4EBE1] text-[#4A4238]'
            };

            const cards = {
                light: 'bg-white shadow-sm border border-slate-200',
                dark: 'bg-slate-800 border border-slate-700',
                muji: 'bg-[#FFF9F3] border border-[#DED0B6]'
            };

            return (
                <div className={`min-h-[100dvh] transition-colors duration-500 font-sans pb-24 ${themes[theme]}`}>
                    {/* Top Navigation: เพิ่ม safe-top เพื่อเว้นระยะติ่งหน้าจอ */}
                    <div className="max-w-md mx-auto p-6 pt-2 flex justify-between items-center sticky top-0 z-10 backdrop-blur-md bg-opacity-80 safe-top">
                        <div>
                            <h1 className="text-2xl font-black tracking-tight">CNX 2026</h1>
                            <p className="text-xs font-bold opacity-50 uppercase tracking-widest">Version iOS.Fixed</p>
                        </div>
                        <div className="flex bg-white/20 p-1 rounded-full backdrop-blur-sm border border-white/30 shadow-inner">
                            <button onClick={() => setTheme('light')} className={`p-2 rounded-full transition-all ${theme === 'light' ? 'bg-white text-yellow-500 shadow' : 'text-slate-400'}`}><SunIcon size={16}/></button>
                            <button onClick={() => setTheme('dark')} className={`p-2 rounded-full transition-all ${theme === 'dark' ? 'bg-slate-700 text-yellow-400 shadow' : 'text-slate-400'}`}><MoonIcon size={16}/></button>
                            <button onClick={() => setTheme('muji')} className={`p-2 rounded-full transition-all ${theme === 'muji' ? 'bg-[#DED0B6] text-[#4A4238] shadow' : 'text-[#A89F91]'}`}><LeafIcon size={16}/></button>
                        </div>
                    </div>

                    <div className="max-w-md mx-auto px-6 space-y-6">
                        
                        {/* Alert */}
                        <div className="bg-orange-500 text-white p-4 rounded-3xl shadow-lg shadow-orange-500/20 flex items-center gap-4">
                            <div className="bg-white/20 p-2 rounded-2xl">
                                <PlaneIcon className="animate-pulse" size={24} />
                            </div>
                            <div className="text-sm">
                                <p className="font-bold">Flight Missed Recovery Plan</p>
                                <p className="opacity-90">แผนใหม่เริ่ม 11:10 น. ลุย!</p>
                            </div>
                        </div>

                        {/* Quick Fuel Log Widget */}
                        <div className={`${cards[theme]} p-5 rounded-[2rem] shadow-sm overflow-hidden relative`}>
                            {!showGasInput ? (
                                <button 
                                    onClick={() => setShowGasInput(true)}
                                    className="w-full flex items-center justify-between group"
                                >
                                    <div className="flex items-center gap-3">
                                        <div className="p-3 bg-blue-100 text-blue-600 rounded-2xl group-hover:scale-110 transition-transform">
                                            <FuelIcon size={24}/>
                                        </div>
                                        <div className="text-left">
                                            <p className="text-xs font-bold opacity-60 uppercase">Quick Log</p>
                                            <p className="font-bold">บันทึกค่าน้ำมันด่วน</p>
                                        </div>
                                    </div>
                                    <ChevronRightIcon size={20} className="opacity-30" />
                                </button>
                            ) : (
                                <div className="space-y-4 animate-in fade-in slide-in-from-top-2">
                                    <div className="flex justify-between items-center">
                                        <p className="text-sm font-bold flex items-center gap-2 text-blue-500">
                                            <FuelIcon size={16}/> ระบุจำนวนเงิน
                                        </p>
                                        <button onClick={() => setShowGasInput(false)} className="text-xs opacity-50">ยกเลิก</button>
                                    </div>
                                    <div className="flex gap-2">
                                        {/* ใช้ text-base เพื่อป้องกัน iPhone ซูมเอง */}
                                        <input 
                                            autoFocus
                                            type="number" 
                                            value={tempGas}
                                            onChange={(e) => setTempGas(e.target.value)}
                                            placeholder="เช่น 500"
                                            className="flex-1 p-3 rounded-2xl bg-black/5 border-none focus:ring-2 focus:ring-blue-400 text-lg text-base font-mono outline-none"
                                        />
                                        <button 
                                            onClick={handleAddGas}
                                            className="px-6 bg-blue-500 text-white rounded-2xl font-bold shadow-lg shadow-blue-500/30 active:scale-95 transition-all"
                                        >
                                            <SaveIcon size={20}/>
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Timeline */}
                        <div className="space-y-6">
                            {itinerary.map((day, idx) => (
                                <div key={idx} className="space-y-4">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-xl font-black flex items-center gap-2">
                                            <MapPinIcon size={22} className="text-red-500"/> {day.title}
                                        </h2>
                                        <span className="text-xs font-bold px-3 py-1 bg-black/5 rounded-full opacity-60">{day.date}</span>
                                    </div>
                                    
                                    <div className="relative ml-4 space-y-6 border-l-2 border-dashed border-black/10 pl-8 pb-4">
                                        {day.items.map((item, i) => (
                                            <div key={i} className="relative group">
                                                <div className={`absolute -left-[41px] top-2 w-4 h-4 rounded-full border-4 border-[#F4EBE1] ${theme === 'muji' ? 'bg-[#4A4238]' : 'bg-slate-400'}`}></div>
                                                
                                                <div className={`${cards[theme]} p-4 rounded-2xl transition-all hover:scale-[1.02] active:scale-[0.98]`}>
                                                    <div className="flex justify-between items-start mb-2">
                                                        <span className="text-[10px] font-black opacity-40 uppercase tracking-tighter bg-black/5 px-2 py-0.5 rounded text-blue-600">
                                                            {item.time}
                                                        </span>
                                                        {item.link && (
                                                            <a href={item.link} target="_blank" rel="noreferrer" className="p-1 rounded bg-blue-50 text-blue-500 hover:bg-blue-500 hover:text-white transition-colors">
                                                                <NavigationIcon size={14}/>
                                                            </a>
                                                        )}
                                                    </div>
                                                    <div className="flex items-start gap-3">
                                                        <div className="mt-1 opacity-80">{item.icon}</div>
                                                        <div>
                                                            <h3 className="font-bold leading-tight">{item.activity}</h3>
                                                            <p className="text-xs opacity-60 mt-0.5">{item.location}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Financial Summary */}
                        <div className={`${cards[theme]} p-6 rounded-[2.5rem] shadow-xl relative overflow-hidden`}>
                            <div className="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-full -mr-16 -mt-16"></div>
                            <h3 className="font-black text-lg mb-4 flex items-center gap-2">
                                Summary Expenses
                            </h3>
                            
                            <div className="space-y-3">
                                <div className="flex justify-between items-center text-sm p-3 bg-black/5 rounded-2xl">
                                    <span className="flex items-center gap-2 opacity-70"><FuelIcon size={16}/> ค่าน้ำมันรวม</span>
                                    <span className="font-mono font-bold text-blue-600 text-lg">฿{gasTotal.toLocaleString()}</span>
                                </div>

                                <div className="flex justify-between items-center text-sm p-3 bg-red-500/5 rounded-2xl text-red-600 border border-red-500/10">
                                    <span className="flex items-center gap-2 font-bold"><PlaneIcon size={16}/> ตั๋วเครื่องบินใหม่</span>
                                    {isEditingFlight ? (
                                        <div className="flex gap-2">
                                            <input 
                                                type="number"
                                                className="w-20 p-1 rounded border-b border-red-500 bg-transparent text-right font-mono outline-none text-base"
                                                onChange={(e) => setFlightCost(parseFloat(e.target.value) || 0)}
                                                onBlur={() => setIsEditingFlight(false)}
                                                autoFocus
                                            />
                                        </div>
                                    ) : (
                                        <span className="font-mono font-bold cursor-pointer" onClick={() => setIsEditingFlight(true)}>
                                            ฿{flightCost.toLocaleString() || '?,???' }
                                        </span>
                                    )}
                                </div>
                            </div>

                            <div className="mt-6 pt-4 border-t border-black/5 flex justify-between items-end">
                                <div>
                                    <p className="text-[10px] font-bold opacity-40 uppercase">Total Spent Today</p>
                                    <p className="text-2xl font-black">฿{(gasTotal + flightCost).toLocaleString()}</p>
                                </div>
                                <div className="text-[10px] bg-green-500 text-white px-2 py-1 rounded-full font-bold uppercase animate-pulse">
                                    Live Update
                                </div>
                            </div>
                        </div>

                    </div>

                    {/* Bottom Floating Nav Mockup: เพิ่ม safe-bottom เพื่อเว้นระยะขีด Home */}
                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 w-full max-w-xs flex justify-around items-center p-3 bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-full border border-white/20 shadow-2xl z-50 safe-bottom">
                        <div className="p-2 text-blue-500"><MapPinIcon size={24}/></div>
                        <div className="p-2 opacity-30"><PlusIcon size={24}/></div>
                        <div className="p-2 opacity-30"><Trash2Icon size={24}/></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


