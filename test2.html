<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RO Classic - Chrono Equipment Refine Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap');
        body { font-family: 'Kanit', sans-serif; background-color: #f3f4f6; }
        .log-container { max-height: 200px; overflow-y: auto; }
        
        /* Custom scrollbar for logs */
        .log-container::-webkit-scrollbar { width: 6px; }
        .log-container::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .log-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .log-container::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <div class="max-w-2xl w-full bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- Header -->
        <div class="bg-blue-600 text-white p-6 text-center">
            <h1 class="text-2xl font-bold"><i class="fas fa-hammer mr-2"></i>Chrono Pass Refine Simulator</h1>
            <p class="text-blue-200 text-sm mt-1">จำลองการอัพเกรด Shadow Weapon / Shield & Infinity Boots</p>
        </div>

        <div class="p-6 md:p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Left Column: Controls -->
            <div class="space-y-6">
                <!-- Equipment Info -->
                <div class="text-center p-6 bg-gray-50 rounded-xl border border-gray-200">
                    <p class="text-gray-500 text-sm font-medium mb-1">ระดับการอัพเกรดปัจจุบัน</p>
                    <div class="text-5xl font-bold text-blue-600" id="currentLevelDisplay">+0</div>
                    <div class="mt-2 text-sm text-gray-600" id="nextRequirement">
                        (ขั้นถัดไป: โอกาส 100%, ใช้ 100,000 Zeny, 5 Medal)
                    </div>
                </div>

                <!-- Modifiers -->
                <div class="space-y-3">
                    <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" id="useGodHammer" class="w-5 h-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500" onchange="updateRequirementText()">
                        <span class="ml-3 flex-1">
                            <span class="block text-sm font-semibold text-gray-900">ใช้ God Hammer</span>
                            <span class="block text-xs text-green-600">+10% โอกาสสำเร็จ</span>
                        </span>
                    </label>

                    <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" id="useGodFurnace" class="w-5 h-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                        <span class="ml-3 flex-1">
                            <span class="block text-sm font-semibold text-gray-900" id="furnaceTitle">ใช้ God Furnace</span>
                            <span class="block text-xs text-blue-600" id="furnaceLabelText">ป้องกันการลดขั้นเมื่อล้มเหลว</span>
                        </span>
                    </label>
                </div>

                <!-- Settings -->
                <div class="bg-white rounded-xl p-4 border border-gray-200 shadow-sm">
                    <h3 class="text-sm font-bold text-gray-700 mb-3"><i class="fas fa-cog mr-2 text-gray-400"></i>ตั้งค่าราคาไอเทม (บาท)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">God Hammer (บาท/ชิ้น)</label>
                            <input type="number" id="hammerPrice" value="75" min="0" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-blue-500 focus:border-blue-500 outline-none transition" oninput="updateUI()">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">God Furnace (บาท/ชิ้น)</label>
                            <input type="number" id="furnacePrice" value="75" min="0" class="w-full p-2 border border-gray-300 rounded text-sm focus:ring-blue-500 focus:border-blue-500 outline-none transition" oninput="updateUI()">
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="space-y-3">
                    <button id="btnRefine" onclick="refine()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition transform active:scale-95 flex justify-center items-center">
                        <i class="fas fa-arrow-up mr-2"></i> ทำการอัพเกรด (Refine)
                    </button>
                    <button onclick="resetApp()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition">
                        <i class="fas fa-undo mr-2"></i> รีเซ็ตข้อมูลใหม่
                    </button>
                </div>
            </div>

            <!-- Right Column: Stats & Logs -->
            <div class="space-y-6 flex flex-col">
                <!-- Summary Stats -->
                <div class="bg-blue-50 rounded-xl p-5 border border-blue-100">
                    <h3 class="text-sm font-bold text-blue-800 mb-3 border-b border-blue-200 pb-2"><i class="fas fa-chart-pie mr-2"></i>สรุปทรัพยากรที่ใช้ไป</h3>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex justify-between flex-col bg-white p-2 rounded shadow-sm">
                            <span class="text-gray-500 text-xs">Zeny</span>
                            <span class="font-bold text-gray-800" id="totalZeny">0</span>
                        </div>
                        <div class="flex justify-between flex-col bg-white p-2 rounded shadow-sm">
                            <span class="text-gray-500 text-xs">Mysterious Medal</span>
                            <span class="font-bold text-purple-600" id="totalMedal">0</span>
                        </div>
                        <div class="flex justify-between flex-col bg-white p-2 rounded shadow-sm">
                            <span class="text-gray-500 text-xs">God Hammer</span>
                            <span class="font-bold text-orange-500" id="totalHammer">0</span>
                        </div>
                        <div class="flex justify-between flex-col bg-white p-2 rounded shadow-sm">
                            <span class="text-gray-500 text-xs">God Furnace</span>
                            <span class="font-bold text-red-500" id="totalFurnace">0</span>
                        </div>
                        <div class="flex justify-between flex-col bg-green-50 p-3 rounded shadow-sm border border-green-200 col-span-2">
                            <span class="text-green-700 text-xs font-bold">รวมค่าใช้จ่ายไอเทมแคช (บาท)</span>
                            <span class="font-bold text-green-600 text-xl" id="totalBaht">0 ฿</span>
                        </div>
                        <div class="flex justify-between flex-col bg-white p-2 rounded shadow-sm col-span-2">
                            <span class="text-gray-500 text-xs">จำนวนครั้งที่พยายามทั้งหมด</span>
                            <span class="font-bold text-blue-600 text-lg" id="totalTry">0 ครั้ง</span>
                        </div>
                    </div>
                </div>

                <!-- Activity Log -->
                <div class="bg-gray-50 rounded-xl p-0 border border-gray-200 flex-1 flex flex-col overflow-hidden">
                    <div class="p-3 bg-gray-100 border-b border-gray-200 text-sm font-bold text-gray-700">
                        <i class="fas fa-list-ul mr-2"></i>ประวัติการตีบวก
                    </div>
                    <div id="logArea" class="log-container p-3 space-y-2 text-sm flex-1 bg-white">
                        <div class="text-gray-400 text-center italic mt-4">ยังไม่มีประวัติการตีบวก</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User Note -->
        <div class="bg-blue-50 p-4 border-t border-blue-200 text-xs text-blue-800 text-center">
            <strong>หมายเหตุ:</strong> อัตราความสำเร็จ ข้อมูลทรัพยากร และระบบ Safe Point อัปเดตตามตารางกิจกรรมของเซิร์ฟเวอร์เรียบร้อยแล้ว!
        </div>
    </div>

    <!-- Notification Overlay (Instead of alert) -->
    <div id="notification" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg transition-opacity duration-300 opacity-0 pointer-events-none z-50 flex items-center">
        <i id="notifIcon" class="fas fa-info-circle mr-2"></i>
        <span id="notifText">Message</span>
    </div>

<script>
    // ==========================================
    // ตารางข้อมูลการตีบวก (แก้ไขตัวเลขจริงที่นี่)
    // chance = โอกาสสำเร็จ (%), zeny = จำนวน Zeny, medal = จำนวน Mysterious Medal
    // ==========================================
    const refineTable = {
        1: { chance: 96, zeny: 100000, medal: 10, furnaceReq: 0, safeLevel: 0 },
        2: { chance: 96, zeny: 100000, medal: 15, furnaceReq: 1, safeLevel: 0 },
        3: { chance: 96, zeny: 100000, medal: 20, furnaceReq: 1, safeLevel: 0 },
        4: { chance: 96, zeny: 100000, medal: 25, furnaceReq: 1, safeLevel: 0 },
        5: { chance: 70, zeny: 100000, medal: 35, furnaceReq: 0, safeLevel: 4 },
        6: { chance: 60, zeny: 200000, medal: 45, furnaceReq: 1, safeLevel: 4 },
        7: { chance: 50, zeny: 200000, medal: 55, furnaceReq: 1, safeLevel: 4 },
        8: { chance: 30, zeny: 200000, medal: 75, furnaceReq: 0, safeLevel: 7 },
        9: { chance: 30, zeny: 200000, medal: 95, furnaceReq: 1, safeLevel: 7 },
        10: { chance: 25, zeny: 200000, medal: 115, furnaceReq: 1, safeLevel: 7 },
        11: { chance: 25, zeny: 300000, medal: 155, furnaceReq: 0, safeLevel: 10 },
        12: { chance: 20, zeny: 300000, medal: 195, furnaceReq: 2, safeLevel: 10 },
        13: { chance: 20, zeny: 300000, medal: 250, furnaceReq: 2, safeLevel: 10 },
        14: { chance: 14, zeny: 300000, medal: 250, furnaceReq: 3, safeLevel: 10 },
        15: { chance: 14, zeny: 300000, medal: 250, furnaceReq: 3, safeLevel: 10 }
    };

    const MAX_LEVEL = 15;
    
    // โหลดเสียง Effect
    const sfxSuccess = new Audio('https://www.myinstants.com/media/sounds/ro-refine-11484.mp3');
    const sfxFail = new Audio('https://www.myinstants.com/media/sounds/ro-refine-failed-38779.mp3');

    let state = {
        level: 0,
        zeny: 0,
        medal: 0,
        hammer: 0,
        furnace: 0,
        tries: 0
    };

    // แสดงข้อความแจ้งเตือน (แทน alert)
    function showNotification(message, type = 'info') {
        const notif = document.getElementById('notification');
        const notifText = document.getElementById('notifText');
        const notifIcon = document.getElementById('notifIcon');
        
        notifText.innerText = message;
        
        if(type === 'error') {
            notif.className = "fixed top-5 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-full shadow-lg transition-opacity duration-300 z-50 flex items-center";
            notifIcon.className = "fas fa-exclamation-triangle mr-2";
        } else {
            notif.className = "fixed top-5 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-full shadow-lg transition-opacity duration-300 z-50 flex items-center";
            notifIcon.className = "fas fa-info-circle mr-2";
        }

        notif.style.opacity = '1';
        
        setTimeout(() => {
            notif.style.opacity = '0';
        }, 3000);
    }

    // เพิ่ม Log
    function addLog(message, isSuccess, currentLvl) {
        const logArea = document.getElementById('logArea');
        
        // เอาข้อความ "ยังไม่มีประวัติ" ออกถ้ามี
        if(state.tries === 1) {
            logArea.innerHTML = '';
        }

        const logItem = document.createElement('div');
        logItem.className = `p-2 rounded border-l-4 ${isSuccess ? 'bg-green-50 border-green-500 text-green-700' : 'bg-red-50 border-red-500 text-red-700'}`;
        
        const icon = isSuccess ? '<i class="fas fa-check-circle mr-1"></i>' : '<i class="fas fa-times-circle mr-1"></i>';
        
        logItem.innerHTML = `
            <div class="flex justify-between items-center">
                <span>${icon} ตีบวก <strong>+${currentLvl}</strong></span>
                <span class="text-xs text-gray-500">ครั้งที่ ${state.tries}</span>
            </div>
            <div class="text-xs mt-1 text-gray-600">${message}</div>
        `;
        
        // แทรกไว้บนสุด
        logArea.insertBefore(logItem, logArea.firstChild);
    }

    // อัพเดทข้อความบอกความต้องการในขั้นถัดไป
    function updateRequirementText() {
        const reqText = document.getElementById('nextRequirement');
        const btnRefine = document.getElementById('btnRefine');

        if (state.level >= MAX_LEVEL) {
            reqText.innerHTML = `<span class="text-green-600 font-bold"><i class="fas fa-star mr-1"></i>ระดับสูงสุดแล้ว</span>`;
            btnRefine.disabled = true;
            btnRefine.className = "w-full bg-gray-400 text-white font-bold py-3 px-4 rounded-lg shadow-md flex justify-center items-center cursor-not-allowed";
            return;
        }

        const nextLevel = state.level + 1;
        const req = refineTable[nextLevel];
        const useHammer = document.getElementById('useGodHammer').checked;
        
        // จัดการหน้าตาของตัวเลือก God Furnace
        const furnaceCheckbox = document.getElementById('useGodFurnace');
        const furnaceTitle = document.getElementById('furnaceTitle');
        const furnaceLabelText = document.getElementById('furnaceLabelText');
        
        if (req.furnaceReq === 0) {
            furnaceCheckbox.checked = false;
            furnaceCheckbox.disabled = true;
            furnaceTitle.classList.add('text-gray-400');
            furnaceLabelText.innerText = `ระดับปลอดภัย (เมื่อล้มเหลวจะไม่ลดต่ำกว่า +${req.safeLevel})`;
            furnaceLabelText.classList.remove('text-blue-600');
            furnaceLabelText.classList.add('text-gray-400');
        } else {
            furnaceCheckbox.disabled = false;
            furnaceTitle.classList.remove('text-gray-400');
            furnaceLabelText.innerText = `ใช้ ${req.furnaceReq} ea เพื่อป้องกันการลดขั้น`;
            furnaceLabelText.classList.remove('text-gray-400');
            furnaceLabelText.classList.add('text-blue-600');
        }

        let displayChance = req.chance;
        if (useHammer) displayChance += 10;
        if (displayChance > 100) displayChance = 100;

        reqText.innerHTML = `(ขั้นถัดไป +${nextLevel}: โอกาส <span class="${displayChance >= 50 ? 'text-green-600' : 'text-orange-500'} font-bold">${displayChance}%</span>, ใช้ ${req.zeny.toLocaleString()} Z, ${req.medal} Medal)`;
        
        btnRefine.disabled = false;
        btnRefine.className = "w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition transform active:scale-95 flex justify-center items-center";
    }

    function refine() {
        if (state.level >= MAX_LEVEL) {
            showNotification("อุปกรณ์ของคุณถึงระดับสูงสุดแล้ว!", "error");
            return;
        }

        const nextLevel = state.level + 1;
        const req = refineTable[nextLevel];

        if (!req) {
            showNotification("เกิดข้อผิดพลาด: ไม่พบข้อมูลตารางการตีบวก", "error");
            return;
        }

        // อ่านค่าไอเทมป้องกัน
        const useHammer = document.getElementById('useGodHammer').checked;
        const useFurnace = document.getElementById('useGodFurnace').checked;

        // หักค่าใช้จ่าย
        state.zeny += req.zeny;
        state.medal += req.medal;
        state.tries += 1;
        if (useHammer) state.hammer += 1; // Hammer ใช้ 1 เสมอ
        if (useFurnace && req.furnaceReq > 0) state.furnace += req.furnaceReq;

        // คำนวณโอกาส
        let currentChance = req.chance;
        if (useHammer) currentChance += 10;
        if (currentChance > 100) currentChance = 100;

        // สุ่มตัวเลข (0.01 - 100.00)
        const roll = (Math.random() * 100).toFixed(2);
        
        let logMsg = "";
        let isSuccess = false;
        let attemptLevel = nextLevel;

        if (roll <= currentChance) {
            // สำเร็จ
            sfxSuccess.currentTime = 0;
            sfxSuccess.play().catch(e => console.log("Audio blocked:", e));

            state.level += 1;
            isSuccess = true;
            logMsg = `สำเร็จ! โอกาส ${currentChance}% (สุ่มได้ ${roll})`;
            
            // Effect เล็กน้อย
            const lvlDisplay = document.getElementById('currentLevelDisplay');
            lvlDisplay.classList.add('text-green-500', 'scale-110');
            setTimeout(() => lvlDisplay.classList.remove('text-green-500', 'scale-110'), 300);

        } else {
            // ล้มเหลว
            sfxFail.currentTime = 0;
            sfxFail.play().catch(e => console.log("Audio blocked:", e));

            isSuccess = false;
            if (useFurnace && req.furnaceReq > 0) {
                logMsg = `ล้มเหลว! (โอกาส ${currentChance}% สุ่มได้ ${roll}) <br><span class="text-blue-600">God Furnace ทำงาน ป้องกันการลดขั้น</span>`;
            } else {
                state.level = Math.max(req.safeLevel, state.level - 1);
                logMsg = `ล้มเหลว! (โอกาส ${currentChance}% สุ่มได้ ${roll}) <br><span class="text-red-600">อุปกรณ์ลดขั้นเหลือ +${state.level}</span>`;
                
                const lvlDisplay = document.getElementById('currentLevelDisplay');
                lvlDisplay.classList.add('text-red-500');
                setTimeout(() => lvlDisplay.classList.remove('text-red-500'), 300);
            }
        }

        addLog(logMsg, isSuccess, attemptLevel);
        updateUI();
    }

    function resetApp() {
        state = { level: 0, zeny: 0, medal: 0, hammer: 0, furnace: 0, tries: 0 };
        document.getElementById('logArea').innerHTML = '<div class="text-gray-400 text-center italic mt-4">ยังไม่มีประวัติการตีบวก</div>';
        
        // Reset checkboxes
        document.getElementById('useGodHammer').checked = false;
        document.getElementById('useGodFurnace').checked = false;
        
        updateUI();
        showNotification("รีเซ็ตข้อมูลทั้งหมดเรียบร้อยแล้ว");
    }

    function updateUI() {
        document.getElementById('currentLevelDisplay').innerText = `+${state.level}`;
        document.getElementById('totalZeny').innerText = state.zeny.toLocaleString();
        document.getElementById('totalMedal').innerText = state.medal.toLocaleString();
        document.getElementById('totalHammer').innerText = state.hammer.toLocaleString();
        document.getElementById('totalFurnace').innerText = state.furnace.toLocaleString();
        document.getElementById('totalTry').innerText = `${state.tries.toLocaleString()} ครั้ง`;
        
        // คำนวณค่าใช้จ่ายเงินบาท
        const hammerPrice = parseFloat(document.getElementById('hammerPrice').value) || 0;
        const furnacePrice = parseFloat(document.getElementById('furnacePrice').value) || 0;
        const totalBaht = (state.hammer * hammerPrice) + (state.furnace * furnacePrice);
        document.getElementById('totalBaht').innerText = `${totalBaht.toLocaleString()} ฿`;
        
        updateRequirementText();
    }

    // Initialize UI
    updateRequirementText();

</script>
</body>
</html>
