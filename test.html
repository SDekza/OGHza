<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Aquarius Diadem Gacha Simulator</title>
    
    <meta name="theme-color" content="#05020a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-touch-fullscreen" content="yes">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700;800;900&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        html { background-color: #05020a; }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #05020a;
            color: #e2e8f0;
            margin: 0;
            padding: 0;
            overscroll-behavior-y: none;
        }

        .georgia-font { font-family: 'Georgia', serif; }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        @keyframes spin-slow { 100% { transform: rotate(360deg); } }
        .magic-circle { animation: spin-slow 20s linear infinite; }

        @keyframes inner-breathe-spin {
            0% { transform: rotate(0deg) scale(0.85); }
            50% { transform: rotate(-180deg) scale(1.05); }
            100% { transform: rotate(-360deg) scale(0.85); }
        }
        .magic-inner-dynamic { animation: inner-breathe-spin 12s ease-in-out infinite; }

        @keyframes magic-glow {
            0%, 100% { filter: drop-shadow(0 0 2px rgba(59, 130, 246, 0.3)); opacity: 0.4; }
            50% { filter: drop-shadow(0 0 15px rgba(96, 165, 250, 0.9)); opacity: 0.9; }
        }
        .magic-glow-effect { animation: magic-glow 4s ease-in-out infinite; }

        @keyframes charge-shake {
            0%, 100% { transform: scale(0.95) rotate(0deg); }
            25% { transform: scale(0.95) rotate(-3deg); }
            75% { transform: scale(0.95) rotate(3deg); }
        }
        .egg-charging {
            animation: charge-shake 0.1s linear infinite;
            filter: drop-shadow(0 0 40px rgba(250, 204, 21, 0.8)) brightness(1.2) !important;
        }

        @keyframes popUp {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop-up { animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        .app-header { padding-top: calc(0.5rem + var(--safe-top)); padding-bottom: 0.5rem; }
        .main-content { padding-top: calc(5.5rem + var(--safe-top)); padding-bottom: calc(2rem + var(--safe-bottom)); }
        .overlay-top { padding-top: calc(4.5rem + var(--safe-top)); }

        input[type="number"].hide-arrows::-webkit-outer-spin-button,
        input[type="number"].hide-arrows::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        #share-template { width: 640px; height: auto; min-height: 850px; }
    </style>
</head>
<body class="relative min-h-screen overflow-x-hidden selection:bg-indigo-500/30">

    <div id="sparkle-overlay" class="fixed inset-0 pointer-events-none z-[999] hidden items-center justify-center">
        <div class="absolute inset-0 bg-yellow-500/10 animate-pulse"></div>
        <svg class="text-yellow-300 w-40 h-40 animate-ping absolute drop-shadow-[0_0_20px_rgba(253,224,71,0.8)]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
    </div>

    <!-- Header ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
    <div class="fixed top-0 left-0 w-full app-header px-4 md:px-6 z-50 bg-[#05020a]/85 backdrop-blur-md border-b border-white/10 shadow-lg flex justify-between items-center">
        <div class="flex items-center gap-2 md:gap-3">
            <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-slate-800 border border-slate-600 flex items-center justify-center shadow-lg text-indigo-400">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <div class="text-slate-300 font-bold tracking-wider text-xs md:text-sm uppercase hidden sm:block">Gacha System</div>
        </div>
        
        <div class="flex items-center gap-4 md:gap-6 bg-slate-900/60 border border-slate-700/50 rounded-xl px-3 md:px-4 py-1.5 md:py-2">
            <div class="flex flex-col items-end">
                <span class="text-[8px] md:text-[9px] text-slate-400 font-medium uppercase tracking-wider mb-0.5">‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span>
                <div class="flex items-baseline gap-1">
                    <span id="total-pulls-text" class="text-sm md:text-base leading-none font-black text-blue-400">0</span>
                    <span class="text-[8px] text-slate-500">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                </div>
            </div>
            <div class="w-[1px] h-6 bg-slate-700/50"></div>
            <div class="flex flex-col items-end">
                <div class="flex items-center gap-1 mb-0.5">
                    <span class="text-[8px] md:text-[9px] text-slate-400 font-medium uppercase tracking-wider">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô </span>
                    <input type="number" id="price-per-pull" value="50" class="w-7 md:w-8 bg-transparent border-b border-slate-600 text-slate-300 text-[8px] md:text-[9px] text-center outline-none p-0 hide-arrows" oninput="updateCost()">
                    <span class="text-[8px] md:text-[9px] text-slate-500">‡∏ø/‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                </div>
                <div class="flex items-baseline gap-1">
                    <span id="total-cost-text" class="text-sm md:text-base leading-none font-black text-red-400">0</span>
                    <span class="text-[8px] text-slate-500">‡∏ø</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay Pull -->
    <div id="pull-overlay" class="fixed inset-0 bg-black/95 z-[100] hidden flex-col items-center justify-start overlay-top px-4 md:p-12 backdrop-blur-xl transition-opacity duration-300 overflow-y-auto" onclick="handleOverlayClick(event)">
        <div id="overlay-header-info" class="sticky top-2 z-[110] flex flex-col items-center w-full max-w-sm mb-6 gap-2">
            <h2 id="overlay-skip-text" class="text-slate-300 font-medium text-xs animate-pulse tracking-widest uppercase text-center bg-black/60 px-4 py-1 rounded-full backdrop-blur-md border border-white/10 shadow-lg cursor-pointer">‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≤‡∏°</h2>
            <h3 id="overlay-pull-count-text" class="text-fuchsia-400 font-black text-lg md:text-xl text-center drop-shadow-[0_0_10px_rgba(192,38,211,0.6)] bg-black/70 px-6 py-2 rounded-full backdrop-blur-md border border-fuchsia-500/30 w-full hidden"></h3>
        </div>
        <div id="overlay-items-container" class="grid grid-cols-3 sm:grid-cols-5 gap-3 md:gap-5 max-w-5xl w-full justify-center pb-20"></div>
        <div id="overlay-actions" class="hidden fixed bottom-0 left-0 w-full flex-col items-center gap-4 pb-6 pt-12 bg-gradient-to-t from-[#020108] via-[#05020a]/90 to-transparent z-[120]" style="padding-bottom: calc(1.5rem + var(--safe-bottom));">
            <div class="flex flex-wrap justify-center gap-3">
                <button onclick="pull(1, true)" class="rounded-full bg-slate-800/90 border border-slate-500 text-white px-6 py-3 font-bold shadow-lg text-sm backdrop-blur-md hover:bg-slate-700">‡∏™‡∏∏‡πà‡∏° x 1</button>
                <button onclick="pull(10, true)" class="rounded-full bg-gradient-to-b from-yellow-500 to-amber-700 border border-yellow-300 text-amber-950 px-6 py-3 font-black shadow-lg text-sm hover:scale-105 transition-transform">‡∏™‡∏∏‡πà‡∏° x 10</button>
                <button onclick="pullUntilSSR(true)" class="rounded-full bg-gradient-to-r from-fuchsia-600 to-purple-700 border border-fuchsia-400 text-white px-6 py-3 font-black shadow-lg text-sm hover:scale-105 transition-transform">‡∏™‡∏∏‡πà‡∏°‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏≠‡∏≠‡∏Å SSR</button>
            </div>
        </div>
    </div>

    <!-- Modal ‡πÅ‡∏ä‡∏£‡πå -->
    <div id="share-modal" class="fixed inset-0 bg-black/90 z-[300] hidden flex-col items-center justify-center p-4 backdrop-blur-md transition-opacity duration-300">
        <h3 class="text-white text-base font-bold mb-4 drop-shadow-md animate-pulse text-center">üì∏ ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ä‡∏£‡πå</h3>
        <div class="relative w-full max-w-sm rounded-2xl overflow-hidden shadow-[0_0_40px_rgba(79,70,229,0.4)] bg-[#090314] border border-indigo-500/50">
            <div id="share-loading" class="absolute inset-0 flex flex-col items-center justify-center bg-[#090314]/90 z-10">
               <div class="animate-spin w-10 h-10 border-4 border-fuchsia-500 border-t-transparent rounded-full mb-3"></div>
               <p class="text-fuchsia-300 text-xs font-bold mt-2">GENERATING MEME...</p>
            </div>
            <img id="share-result-img" src="" alt="Share Result" class="w-full h-auto object-contain hidden" />
        </div>
        <button onclick="closeShareModal()" class="mt-6 rounded-full bg-slate-800/80 border border-slate-500 text-white px-8 py-3 font-bold hover:bg-slate-700 transition-colors">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
    </div>

    <!-- üéØ Hidden Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Share -->
    <div class="fixed top-0" style="left: -9999px;">
        <div id="share-template" class="p-10 relative overflow-hidden flex flex-col items-center bg-[#090314]">
            <div class="absolute inset-0 z-0 pointer-events-none" style="background: radial-gradient(circle at 50% 30%, rgba(93, 21, 135, 0.4) 0%, transparent 100%);"></div>
            <div id="share-magic-circle" class="absolute top-[35%] left-[50%] w-[110%] opacity-20 pointer-events-none text-cyan-200 z-0" style="transform: translate(-50%, -50%);">
                <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="0.3">
                    <circle cx="50" cy="50" r="45" stroke-dasharray="2 6"/><circle cx="50" cy="50" r="35"/><circle cx="50" cy="50" r="20" stroke-dasharray="10 5"/>
                    <polygon points="50,5 95,75 5,75" stroke-width="0.2" opacity="0.4"/><polygon points="50,95 5,25 95,25" stroke-width="0.2" opacity="0.4"/>
                </svg>
            </div>
            
            <div class="relative z-10 w-full flex flex-col items-center">
                <!-- Header (Share) -->
                <div class="w-full flex items-center justify-center gap-6 mb-14 mt-6 z-10 relative h-[110px]">
                    <div class="h-[110px] w-[110px] shrink-0 flex items-center justify-center">
                        <!-- üéØ ‡πÄ‡∏û‡∏¥‡πà‡∏° id="share-egg-img" ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Path ‡πÑ‡∏Ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå AQUARIUS_DIADEM -->
                        <img id="share-egg-img" src="images/AQUARIUS_DIADEM/egg.png" class="h-full w-auto max-w-full object-contain drop-shadow-[0_0_15px_rgba(59,130,246,0.6)]" crossorigin="anonymous" />
                    </div>
                    <div class="h-[110px] flex flex-col justify-between items-start">
                        <h1 id="share-title-1" class="text-[60px] font-black leading-none drop-shadow-[0_4px_8px_rgba(0,0,0,0.8)] georgia-font text-yellow-400 m-0 p-0" style="margin-top: -8px;">AQUARIUS</h1>
                        <h1 id="share-title-2" class="text-[60px] font-black leading-none drop-shadow-[0_4px_8px_rgba(0,0,0,0.8)] georgia-font text-cyan-400 m-0 p-0" style="margin-bottom: -10px;">DIADEM</h1>
                    </div>
                </div>

                <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏î‡∏ß‡∏á -->
                <div class="w-full text-center relative mb-12">
                    <div id="tpl-luck-name" class="text-[26px] leading-none font-black text-white drop-shadow-[0_4px_10px_rgba(0,0,0,1)] mb-4 uppercase tracking-[0.3em]">üëë ‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏Å GM</div>
                    <div id="tpl-fun-quote" class="text-yellow-300 font-bold text-xl italic drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]">"‡∏ä‡∏≤‡∏ï‡∏¥‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏î‡∏ß‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß!"</div>
                </div>

                <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
                <div class="w-full flex justify-center gap-16 mb-12">
                    <div class="flex flex-col items-center">
                        <span class="text-rose-400 text-[10px] font-black uppercase tracking-widest mb-2 opacity-80">üí∏ ‡πÇ‡∏î‡∏ô‡∏™‡∏π‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span>
                        <span id="tpl-cost" class="text-5xl font-black text-white drop-shadow-[0_0_20px_rgba(225,29,72,0.8)]">0 ‡∏ø</span>
                    </div>
                    <div class="w-[1px] h-16 bg-white/20 self-center"></div>
                    <div class="flex flex-col items-center">
                        <span class="text-cyan-400 text-[10px] font-black uppercase tracking-widest mb-2 opacity-80">üé∞ ‡∏Å‡∏î‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                        <span id="tpl-pulls" class="text-5xl font-black text-white drop-shadow-[0_0_20px_rgba(34,211,238,0.8)]">0 ‡πÇ‡∏£‡∏•</span>
                    </div>
                </div>

                <!-- Section ‡∏Ç‡∏≠‡∏á‡πÅ‡∏£‡∏£‡πå -->
                <div class="w-full flex flex-col mt-4">
                    <div class="flex justify-between items-end mb-6 border-b border-white/20 pb-3 px-4">
                        <h3 class="text-xl font-black text-white flex items-center gap-2">‚ú® ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡∏ñ‡∏∂‡∏á‡∏ó‡πâ‡∏≠‡∏á</h3>
                        <span id="tpl-ssr-count" class="text-sm font-bold text-yellow-400">SSR: 0</span>
                    </div>
                    <div id="tpl-rare-grid" class="grid grid-cols-3 gap-y-6 gap-x-4 px-2"></div>
                </div>

                <!-- Footer -->
                <div class="mt-12 pt-6 flex justify-between items-center text-slate-400/60 text-[11px] font-bold uppercase tracking-[0.3em] w-full px-4 border-t border-white/10">
                    <span class="text-cyan-400/90">#gacha_simulator</span>
                    <div class="flex items-center justify-center text-slate-300">
                        <svg width="18" height="18" class="text-red-500 mr-2 transform translate-y-[2.5px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                        <span>YOUTUBE: @SDEKZA-RO</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- UI ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
    <div class="relative z-10 max-w-[1400px] mx-auto min-h-screen flex flex-col lg:flex-row main-content">
        <div class="w-full lg:w-5/12 flex flex-col items-center justify-center p-6 mt-4 lg:mt-0">
            
            <!-- üéØ ‡∏£‡∏∞‡∏ö‡∏ö Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏π‡πâ‡∏Å‡∏≤‡∏ä‡∏≤ (Data-Driven Design) -->
            <div class="flex justify-center gap-3 mb-6 relative z-20">
                <button id="tab-banner1" onclick="switchBanner('banner1')" class="px-5 py-2 rounded-full text-[10px] md:text-xs font-black uppercase tracking-widest transition-all bg-blue-600 text-white shadow-[0_0_15px_rgba(37,99,235,0.6)] border border-blue-400 transform scale-105 pointer-events-none">1. AQUARIUS</button>
                <button id="tab-banner2" onclick="switchBanner('banner2')" class="px-5 py-2 rounded-full text-[10px] md:text-xs font-bold uppercase tracking-widest transition-all bg-slate-800/80 text-slate-400 border border-slate-600 hover:text-white hover:bg-slate-700 backdrop-blur-sm cursor-pointer">2. DIADEM V2</button>
            </div>

            <div class="text-center mb-8">
                <h1 class="text-5xl md:text-7xl font-black mb-2 georgia-font leading-tight text-white drop-shadow-xl">
                    <span id="main-title-1" class="bg-gradient-to-b from-yellow-100 via-yellow-400 to-amber-600 bg-clip-text text-transparent block uppercase">AQUARIUS</span>
                    <span id="main-title-2" class="bg-gradient-to-b from-blue-100 via-blue-400 to-indigo-600 bg-clip-text text-transparent block uppercase">DIADEM</span>
                </h1>
                <p class="text-indigo-200/80 font-bold tracking-[0.3em] uppercase text-[10px] md:text-xs text-center">Scroll Simulator</p>
            </div>
            
            <!-- ‡πÑ‡∏Ç‡πà‡∏Å‡∏≤‡∏ä‡∏≤ (‡∏Å‡∏î‡∏¢‡∏∏‡∏ö ‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏û‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ) -->
            <div id="egg-container" 
                 class="relative flex items-center justify-center w-full max-w-[280px] aspect-square cursor-pointer transition-transform active:scale-95"
                 style="touch-action: none; -webkit-tap-highlight-color: transparent;"
                 onpointerdown="startHold(event)" 
                 onpointerup="endHold(event)" 
                 onpointerleave="cancelHold(event)" 
                 onpointercancel="cancelHold(event)">
                <div class="absolute inset-0 flex items-center justify-center text-blue-400 scale-[1.4] magic-glow-effect pointer-events-none">
                    <svg class="w-full h-full" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="0.5">
                        <g class="magic-circle" style="transform-origin: 50px 50px;"><circle cx="50" cy="50" r="48" stroke-dasharray="4 4"/></g>
                        <g class="magic-inner-dynamic" style="transform-origin: 50px 50px;">
                            <circle cx="50" cy="50" r="40"/><circle cx="50" cy="50" r="30" stroke-dasharray="8 4" opacity="0.8"/>
                            <polygon points="50,15 80,67 20,67" stroke-width="0.3"/><polygon points="50,85 20,33 80,33" stroke-width="0.3"/>
                        </g>
                    </svg>
                </div>
                <div class="absolute w-40 h-40 bg-blue-500 rounded-full blur-[60px] opacity-30 pointer-events-none"></div>
                <!-- üéØ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Path ‡∏£‡∏π‡∏õ‡πÑ‡∏Ç‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
                <img id="egg-img" src="images/AQUARIUS_DIADEM/egg.png" alt="Egg" class="relative z-10 h-[70%] w-auto max-w-full object-contain drop-shadow-[0_0_30px_rgba(59,130,246,0.4)] pointer-events-none transition-all duration-300" />
            </div>
            
            <!-- ‡∏õ‡πâ‡∏≤‡∏¢‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏î -->
            <div class="mt-4 text-center select-none pointer-events-none">
                 <p class="text-[11px] md:text-xs font-bold text-slate-300 tracking-widest uppercase bg-slate-800/50 px-4 py-2 rounded-full border border-slate-600/50 shadow-lg backdrop-blur-sm animate-pulse">
                    üëÜ ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡πà‡∏° x1 <span class="mx-2 text-slate-500">|</span> ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡πà‡∏° x10
                </p>
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏• Auto Mode (‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏π‡∏õ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ó‡∏≠‡∏∞‡∏ó‡∏∞) -->
            <div class="flex justify-center mt-5 w-full">
                <button id="btn-pull-until-ssr" onclick="pullUntilSSR()" 
                        class="group relative px-5 py-2 rounded-full bg-[#05020a]/60 border border-fuchsia-500/40 text-fuchsia-300 font-bold text-[10px] md:text-xs tracking-widest uppercase hover:bg-fuchsia-900/40 hover:border-fuchsia-400 hover:text-white transition-all duration-300 flex items-center gap-2 overflow-hidden shadow-[0_0_15px_rgba(192,38,211,0.15)] hover:shadow-[0_0_25px_rgba(192,38,211,0.4)] active:scale-95 disabled:opacity-50 disabled:pointer-events-none">
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-fuchsia-500/20 to-transparent -translate-x-[150%] group-hover:translate-x-[150%] transition-transform duration-700 ease-in-out"></div>
                    <svg class="w-3.5 h-3.5 text-fuchsia-400 group-hover:text-white transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                        <path d="M21 3v5h-5"/>
                    </svg>
                    Auto: Until SSR
                </button>
            </div>
        </div>

        <div class="w-full lg:w-7/12 flex flex-col gap-6 p-4 md:p-8 lg:overflow-y-auto">
            <div class="glass-panel rounded-3xl p-6 min-h-[300px]">
                <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                    <h3 class="text-lg font-bold text-white uppercase tracking-widest">Inventory</h3>
                    <button onclick="resetData()" class="px-4 py-2 text-[10px] font-bold uppercase text-red-400 bg-red-950/30 border border-red-900/50 rounded-lg hover:bg-red-900/60 transition-colors">Clear</button>
                </div>
                <div id="empty-inventory-state" class="h-40 flex flex-col items-center justify-center text-slate-500 text-sm italic">Tap Summon to start</div>
                <div id="inventory-section" class="hidden"><div id="inventory-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3"></div></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-20">
                <div id="luck-meter-container" class="glass-panel rounded-3xl p-6 hidden text-center">
                    <h3 class="text-[10px] font-bold tracking-widest uppercase mb-4 text-slate-400">Luck Meter</h3>
                    <div id="luck-tier-name" class="text-xl font-black mb-1">üëë ‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏Å GM</div>
                    <div id="luck-tier-desc" class="text-[10px] font-medium text-slate-400 uppercase mb-4">Lucky! Let's pull more!</div>
                    <div class="space-y-3 text-[10px] font-medium text-slate-300 mb-6 text-left">
                        <div class="flex justify-between items-center bg-slate-800/40 p-2 rounded-lg"><span>Luck Score:</span> <span id="luck-score-text" class="font-black text-white">120%</span></div>
                        <div class="flex justify-between px-2"><span>SSR Acquired:</span> <span id="luck-ssr-actual" class="font-bold text-yellow-400">0</span></div>
                        <div class="flex justify-between px-2 text-slate-500"><span>Expected:</span> <span id="luck-ssr-expected">0.00</span></div>
                    </div>
                    <button onclick="openShareModal()" class="w-full rounded-xl bg-gradient-to-r from-fuchsia-600 to-purple-600 text-white py-3 font-black text-sm uppercase shadow-lg hover:scale-[1.02] transition-all">‡πÅ‡∏ä‡∏£‡πå‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ üì∏</button>
                </div>
                <div class="glass-panel rounded-3xl p-6">
                    <h3 class="text-[10px] font-bold tracking-widest uppercase mb-4 text-slate-400">Rates</h3>
                    <div id="rates-container" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üéØ 1. ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô Base (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Path ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå AQUARIUS_DIADEM ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢)
        const BASE_ITEMS = [
            { id: 'ssr1', name: 'Sealed Card Album II', rank: 'SSR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/1.png' },
            { id: 'ssr2', name: 'Sealed Card Album', rank: 'SSR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/2.png' },
            { id: 'ssr3', name: 'Costume Arabian Veil', rank: 'SSR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/3.png' },
            { id: 'ssr4', name: "Rasen Huuma's Orb [1]", rank: 'SSR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/4.png' },
            { id: 'ssr5', name: 'Aquarius Diadem [1]', rank: 'SSR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/5.png' },
            { id: 'sr1', name: 'Aquarius Staff [2]', rank: 'SR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/6.png' },
            { id: 'sr2', name: 'Aquarius Ring [1]', rank: 'SR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/7.png' },
            { id: 'sr3', name: 'Huuma Shuriken Clearness [2]', rank: 'SR', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/8.png' },
            { id: 'r1', name: 'Cross Shuriken Shadow Earring', rank: 'R', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/9.png' },
            { id: 'r2', name: 'Magic Compose Shadow Armor', rank: 'R', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/10.png' },
            { id: 'r3', name: 'Blitz Shadow Pendant', rank: 'R', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/11.png' },
            { id: 'r4', name: 'Blitz Shadow Earring', rank: 'R', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/12.png' },
            { id: 'r5', name: 'Status Shadow Item Combiner', rank: 'R', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/13.png' },
            { id: 'a1', name: 'Blood Twig', rank: 'A', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/14.png' },
            { id: 'b1', name: 'Class Shadow Cube', rank: 'B', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/15.png' },
            { id: 'b2', name: 'Poison Bottle Box', rank: 'B', qty: 1, imgSrc: 'images/AQUARIUS_DIADEM/16.png' },
            { id: 'b3', name: 'STR Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/AQUARIUS_DIADEM/17.png' },
            { id: 'b4', name: 'AGI Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/AQUARIUS_DIADEM/18.png' },
            { id: 'b5', name: 'INT Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/AQUARIUS_DIADEM/19.png' },
            { id: 'b6', name: 'VIT Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/AQUARIUS_DIADEM/20.png' },
            { id: 'b7', name: 'DEX Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/AQUARIUS_DIADEM/21.png' },
            { id: 'b8', name: 'LUK Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/AQUARIUS_DIADEM/22.png' },
            { id: 'c1', name: 'Blessing Lv.10 Scroll', rank: 'C', qty: 10, imgSrc: 'images/AQUARIUS_DIADEM/23.png' },
            { id: 'c2', name: 'Increase Agility Lv.10 Scroll', rank: 'C', qty: 10, imgSrc: 'images/AQUARIUS_DIADEM/24.png' },
            { id: 'e1', name: 'Ex Def Potion', rank: 'E', qty: 5, imgSrc: 'images/AQUARIUS_DIADEM/25.png' },
            { id: 'e2', name: 'Kafra Card', rank: 'E', qty: 5, imgSrc: 'images/AQUARIUS_DIADEM/26.png' },
        ];

        // üéØ 2. ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° Gacha Hub: ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ï‡∏π‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Object ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        const GACHA_BANNERS = {
            'banner1': {
                id: 'banner1',
                title1: 'AQUARIUS',
                title2: 'DIADEM',
                eggImage: 'images/AQUARIUS_DIADEM/egg.png', // üéØ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏£‡∏π‡∏õ‡πÑ‡∏Ç‡πà‡πÅ‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å‡∏ï‡∏π‡πâ
                rates: { SSR: 0.5, SR: 1.5, R: 10.0, A: 15.0, B: 31.0, C: 21.0, E: 21.0 },
                expectedScore: 10.43,
                items: BASE_ITEMS
            },
            'banner2': {
                id: 'banner2',
                title1: 'AQUARIUS',
                title2: 'DIADEM 2',
                eggImage: 'images/AQUARIUS_DIADEM/egg.png', // üéØ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
                rates: { SSR: 0.5, SR: 1.5, R: 10.0, A: 15.0, B: 31.0, C: 21.0, E: 21.0 },
                expectedScore: 10.43,
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ (V.2) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏π‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏£‡∏¥‡∏á
                items: BASE_ITEMS.map(item => ({ ...item, id: item.id + '_v2', name: item.name + ' (V.2)' }))
            }
        };

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏π‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏π‡πâ‡πÅ‡∏£‡∏Å)
        let currentBannerId = 'banner1';
        let currentBanner = GACHA_BANNERS[currentBannerId];

        // Style ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Rank (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ï‡∏π‡πâ)
        const RANK_STYLES = {
            'SSR': { bg: 'bg-gradient-to-br from-yellow-100 to-amber-200 ssr-glow', border: 'border-yellow-400', text: 'text-amber-900 font-extrabold', grad: 'from-amber-400 to-yellow-600', hex: 'text-yellow-400', shareBg: 'bg-yellow-500/10 border border-yellow-500/30' },
            'SR': { bg: 'bg-purple-100', border: 'border-purple-300', text: 'text-purple-900 font-bold', grad: 'from-purple-400 to-purple-600', hex: 'text-purple-400', shareBg: 'bg-purple-500/10 border border-purple-500/30' },
            'R': { bg: 'bg-blue-100', border: 'border-blue-300', text: 'text-blue-900 font-bold', grad: 'from-blue-400 to-blue-600' },
            'A': { bg: 'bg-emerald-100', border: 'border-emerald-300', text: 'text-emerald-900 font-bold', grad: 'from-emerald-400 to-emerald-600' },
            'B': { bg: 'bg-lime-100', border: 'border-lime-300', text: 'text-lime-900 font-bold', grad: 'from-lime-400 to-lime-600' },
            'C': { bg: 'bg-white', border: 'border-slate-300', text: 'text-slate-800 font-bold', grad: 'from-slate-300 to-slate-400' },
            'E': { bg: 'bg-slate-200', border: 'border-slate-400', text: 'text-slate-700 font-bold', grad: 'from-slate-400 to-slate-500' }
        };
        const RANK_POINTS = { 'SSR': 500, 'SR': 100, 'R': 20, 'A': 15, 'B': 5, 'C': 2, 'E': 1 };

        let history = [], totalPulls = 0, isSpinning = false, currentAnimationInterval = null, pullTimeout = null;
        let isOverlayAnimating = false, isAutoPulling = false, autoPullCount = 0, currentLuckData = {};
        
        let holdTimer = null;
        let isHolding = false;
        const HOLD_DURATION = 600;

        // üéØ 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏π‡πâ (Switch Banner)
        function switchBanner(targetId) {
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏π‡πâ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏™‡∏∏‡πà‡∏°‡∏≠‡∏¢‡∏π‡πà
            if (isSpinning || isOverlayAnimating || isAutoPulling) return;
            
            currentBannerId = targetId;
            currentBanner = GACHA_BANNERS[targetId];

            // 3.1 ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏õ‡∏∏‡πà‡∏° Tab ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
            const tabs = ['banner1', 'banner2'];
            tabs.forEach(tId => {
                const btn = document.getElementById('tab-' + tId);
                if (tId === targetId) {
                    btn.className = "px-5 py-2 rounded-full text-[10px] md:text-xs font-black uppercase tracking-widest transition-all bg-blue-600 text-white shadow-[0_0_15px_rgba(37,99,235,0.6)] border border-blue-400 transform scale-105 pointer-events-none";
                } else {
                    btn.className = "px-5 py-2 rounded-full text-[10px] md:text-xs font-bold uppercase tracking-widest transition-all bg-slate-800/80 text-slate-400 border border-slate-600 hover:text-white hover:bg-slate-700 backdrop-blur-sm cursor-pointer";
                }
            });

            // 3.2 ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Title ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            document.getElementById('main-title-1').innerText = currentBanner.title1;
            document.getElementById('main-title-2').innerText = currentBanner.title2;
            
            // 3.3 ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Title ‡πÉ‡∏ô‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÉ‡∏ö‡πÅ‡∏ä‡∏£‡πå
            document.getElementById('share-title-1').innerText = currentBanner.title1;
            document.getElementById('share-title-2').innerText = currentBanner.title2;
            
            // üéØ 3.4 ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÑ‡∏Ç‡πà‡∏ï‡∏≤‡∏°‡∏ï‡∏π‡πâ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÅ‡∏ä‡∏£‡πå)
            document.getElementById('egg-img').src = currentBanner.eggImage;
            document.getElementById('share-egg-img').src = currentBanner.eggImage;

            // 3.5 ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
            resetData();
            renderRates(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏ó‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÄ‡∏£‡∏ó‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏π‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô)
        }

        function startHold(e) {
            if (isSpinning) return;
            isHolding = false;
            const egg = document.getElementById('egg-img');
            egg.classList.add('egg-charging');
            
            holdTimer = setTimeout(() => {
                isHolding = true;
                egg.classList.remove('egg-charging');
                if (navigator.vibrate) navigator.vibrate([50, 50, 100]);
                pull(10);
            }, HOLD_DURATION);
        }

        function endHold(e) {
            if (isSpinning && !isHolding) return;
            clearTimeout(holdTimer);
            const egg = document.getElementById('egg-img');
            egg.classList.remove('egg-charging');
            if (!isHolding && !isSpinning) { pull(1); }
            isHolding = false;
        }

        function cancelHold(e) {
            clearTimeout(holdTimer);
            isHolding = false;
            document.getElementById('egg-img').classList.remove('egg-charging');
        }

        function preloadImages() { 
            // üéØ ‡∏î‡∏∂‡∏á‡∏†‡∏≤‡∏û‡πÑ‡∏Ç‡πà‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏û‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏à‡∏≤‡∏Å "‡∏ó‡∏∏‡∏Å‡∏ï‡∏π‡πâ" ‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡∏ô‡∏≤‡∏°‡∏¥‡∏Å
            const allImages = new Set();
            Object.values(GACHA_BANNERS).forEach(banner => {
                allImages.add(banner.eggImage);
                banner.items.forEach(i => allImages.add(i.imgSrc));
            });
            Array.from(allImages).forEach(src => { const img = new Image(); img.src = src; }); 
        }

        function updateCost() { const price = parseFloat(document.getElementById('price-per-pull').value) || 0; const totalCost = totalPulls * price; document.getElementById('total-cost-text').innerText = totalCost.toLocaleString(); return totalCost; }
        
        function renderRates() { 
            let html = ''; 
            // üéØ ‡πÉ‡∏ä‡πâ currentBanner.rates ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ Fixed
            for (const [rank, rate] of Object.entries(currentBanner.rates)) { 
                const style = RANK_STYLES[rank]; 
                html += `<div class="flex justify-between items-center text-[10px] font-medium"><span class="w-8 font-black text-transparent bg-clip-text bg-gradient-to-b ${style.grad}">${rank}</span><div class="flex-1 mx-3 h-1 bg-slate-800 rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r ${style.grad}" style="width: ${rate}%"></div></div><span class="text-slate-400 w-10 text-right">${rate}%</span></div>`; 
            } 
            document.getElementById('rates-container').innerHTML = html; 
        }
        
        function updateLuckMeter() {
            const container = document.getElementById('luck-meter-container');
            if (totalPulls === 0) { container.classList.add('hidden'); return; }
            container.classList.remove('hidden');
            let totalPoints = 0, ssrCount = 0;
            history.forEach(item => { totalPoints += RANK_POINTS[item.rank] || 0; if (item.rank === 'SSR') ssrCount++; });
            
            // üéØ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Expected Score ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏π‡πâ
            const luckRatio = (totalPoints / totalPulls) / currentBanner.expectedScore;
            const luckPercent = (luckRatio * 100).toFixed(0);
            
            let tN, tD, tC, funQuote;
            if (luckRatio >= 3.0) { tN = 'üëº ‡∏à‡∏∏‡∏ï‡∏¥‡∏°‡∏≤‡πÄ‡∏Å‡∏¥‡∏î'; tD = 'GOD TIER!'; tC = 'text-amber-400'; funQuote = '"‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏ó‡πà‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Å‡πá‡πÄ‡∏ó‡∏û‡πÄ‡∏à‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!"'; } 
            else if (luckRatio >= 2.0) { tN = 'üëë ‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏Å GM'; tD = 'GM PICKET!'; tC = 'text-purple-400'; funQuote = '"‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡∏¥‡∏ö‡∏•‡πâ‡∏≠‡∏ï‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏ñ‡∏ô‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!"'; } 
            else if (luckRatio >= 1.5) { tN = 'üåü ‡πÇ‡∏Ñ‡∏ï‡∏£‡πÄ‡∏Æ‡∏á'; tD = 'SUPER LUCKY!'; tC = 'text-pink-400'; funQuote = '"‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÅ‡∏£‡∏á ‡πÅ‡∏Ç‡πà‡∏á‡∏ö‡∏∏‡∏ç‡∏ß‡∏≤‡∏™‡∏ô‡∏≤‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÜ"'; } 
            else if (luckRatio >= 1.2) { tN = '‚ú® ‡∏î‡∏ß‡∏á‡∏î‡∏µ'; tD = 'LUCKY!'; tC = 'text-blue-400'; funQuote = '"‡πÅ‡∏´‡∏°‡∏°‡∏° ‡∏ó‡∏≥‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏¥‡∏á!"'; } 
            else if (luckRatio >= 1.0) { tN = 'üòè ‡∏Ñ‡∏∏‡πâ‡∏°‡∏ó‡∏∏‡∏ô'; tD = 'PROFIT!'; tC = 'text-cyan-400'; funQuote = '"‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏ô‡πâ‡∏ô‡πÜ ‡πÑ‡∏°‡πà‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏Å‡πá‡∏ö‡∏∏‡∏ç‡πÅ‡∏•‡πâ‡∏ß"'; } 
            else if (luckRatio >= 0.85) { tN = 'üòê ‡∏õ‡∏Å‡∏ï‡∏¥‡∏ä‡∏ô'; tD = 'AVERAGE'; tC = 'text-green-400'; funQuote = '"‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÜ ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥"'; } 
            else if (luckRatio >= 0.7) { tN = 'ü§è ‡πÅ‡∏≠‡∏ö‡πÄ‡∏Å‡∏•‡∏∑‡∏≠'; tD = 'SLIGHTLY SALTY'; tC = 'text-yellow-500'; funQuote = '"‡πÑ‡∏î‡πâ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡πÇ‡∏ä‡∏¢‡∏°‡∏≤‡πÅ‡∏ï‡πà‡πÑ‡∏Å‡∏•..."'; } 
            else if (luckRatio >= 0.5) { tN = 'üßÇ ‡πÄ‡∏Å‡∏•‡∏∑‡∏≠'; tD = 'SALTY'; tC = 'text-orange-400'; funQuote = '"‡πÄ‡∏Ñ‡πá‡∏°‡∏õ‡∏µ‡πã‡πÄ‡∏•‡∏¢‡∏•‡∏π‡∏Å‡∏û‡∏µ‡πà ‡πÑ‡∏ï‡∏à‡∏∞‡∏û‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß!"'; } 
            else if (luckRatio >= 0.3) { tN = 'üèúÔ∏è ‡πÇ‡∏Ñ‡∏ï‡∏£‡πÄ‡∏Å‡∏•‡∏∑‡∏≠'; tD = 'VERY SALTY'; tC = 'text-orange-600'; funQuote = '"‡πÅ‡∏´‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô ‡∏ñ‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏ó‡∏±‡∏ô"'; } 
            else { tN = 'üíÄ ‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏î‡∏î‡∏ã‡∏µ'; tD = 'EXTREME SALT'; tC = 'text-red-500'; funQuote = '"‡∏™‡∏ß‡∏î‡∏≠‡∏†‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏û‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏ï‡∏±‡∏á‡∏Ñ‡πå ‡∏•‡∏ö‡πÄ‡∏Å‡∏°‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏ñ‡∏≠‡∏∞"'; }
            
            document.getElementById('luck-tier-name').innerText = tN; document.getElementById('luck-tier-name').className = `text-xl font-black mb-1 ${tC}`;
            document.getElementById('luck-tier-desc').innerText = tD; document.getElementById('luck-score-text').innerText = `${luckPercent}%`;
            document.getElementById('luck-ssr-actual').innerText = ssrCount.toLocaleString(); 
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Expected SSR ‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡∏ô‡∏≤‡∏°‡∏¥‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏ó‡∏Ç‡∏≠‡∏á‡∏ï‡∏π‡πâ
            document.getElementById('luck-ssr-expected').innerText = (totalPulls * (currentBanner.rates.SSR / 100)).toFixed(2);
            currentLuckData = { tN, tD, tC, luckPercent, ssrCount, funQuote };
        }

        function createOverlayItemHTML(item) {
            const style = RANK_STYLES[item.rank];
            return `<div class="${style.bg} border ${style.border} p-2 rounded-xl text-center flex flex-col items-center justify-between min-h-[100px] relative overflow-hidden group animate-pop-up shadow-xl backdrop-blur-md"><img src="${item.imgSrc}" alt="${item.name}" class="w-12 h-12 mt-2 z-10 object-contain mix-blend-multiply" /><div class="z-10 w-full mt-1 pb-1 relative"><p class="text-[9px] leading-tight line-clamp-2 ${style.text}">${item.name}</p></div></div>`;
        }

        function openShareModal() {
            if (totalPulls === 0) return;
            const modal = document.getElementById('share-modal'), loading = document.getElementById('share-loading'), resultImg = document.getElementById('share-result-img');
            modal.classList.remove('hidden'); modal.classList.add('flex'); loading.classList.remove('hidden'); resultImg.classList.add('hidden');
            const totalCost = updateCost();
            document.getElementById('tpl-luck-name').innerText = currentLuckData.tN;
            document.getElementById('tpl-luck-name').className = `text-[26px] leading-none font-black text-white drop-shadow-[0_4px_10px_rgba(0,0,0,1)] mb-4 ${currentLuckData.tC} uppercase tracking-[0.3em]`;
            document.getElementById('tpl-fun-quote').innerText = currentLuckData.funQuote;
            document.getElementById('tpl-cost').innerText = totalCost.toLocaleString() + ' ‡∏ø';
            document.getElementById('tpl-pulls').innerText = totalPulls.toLocaleString() + ' ‡πÇ‡∏£‡∏•';
            document.getElementById('tpl-ssr-count').innerText = `SSR: ${currentLuckData.ssrCount.toLocaleString()}`;
            const mc = document.getElementById('share-magic-circle'); if (mc) { mc.style.top = `${Math.floor(Math.random() * 40) + 30}%`; mc.style.left = `${Math.floor(Math.random() * 40) + 30}%`; mc.style.transform = `translate(-50%, -50%) scale(${Math.random() * 0.7 + 0.8}) rotate(${Math.floor(Math.random() * 360)}deg)`; }
            const rareInventory = {}; history.forEach(item => { if(item.rank === 'SSR' || item.rank === 'SR') { if (rareInventory[item.id]) rareInventory[item.id].totalCount += item.qty; else rareInventory[item.id] = { ...item, totalCount: item.qty }; } });
            const sortedRares = Object.values(rareInventory).sort((a, b) => (a.rank === 'SSR' ? 1 : 2) - (b.rank === 'SSR' ? 1 : 2));
            const rg = document.getElementById('tpl-rare-grid'); if (sortedRares.length === 0) rg.innerHTML = `<div class="col-span-3 flex flex-col items-center justify-center py-12 text-6xl">üßÇ<p class="text-white text-xl font-bold mt-4">‡πÄ‡∏Å‡∏•‡∏∑‡∏≠‡∏•‡πâ‡∏ß‡∏ô‡πÜ!</p></div>`;
            else { let html = ''; sortedRares.slice(0, 9).forEach(item => { const s = RANK_STYLES[item.rank]; const glow = item.rank === 'SSR' ? 'drop-shadow-[0_0_10px_rgba(250,204,21,0.6)]' : 'drop-shadow-[0_0_8px_rgba(168,85,247,0.5)]'; html += `<div class="${s.shareBg} p-3 rounded-xl flex flex-col items-center text-center relative z-10 shadow-sm min-h-[130px]"><div class="absolute top-1 right-2 text-[20px] font-black text-white drop-shadow-[0_2px_4px_rgba(0,0,0,1)] z-20">x${item.totalCount}</div><img src="${item.imgSrc}" class="w-14 h-14 mb-2 object-contain ${glow}" crossorigin="anonymous" /><p class="text-[11px] font-bold text-white flex-1 leading-tight">${item.name}</p><p class="text-[12px] font-black uppercase ${s.hex}">${item.rank}</p></div>`; }); rg.innerHTML = html; }
            const target = document.getElementById('share-template'); const imgs = Array.from(target.querySelectorAll('img'));
            Promise.all(imgs.map(img => img.complete ? Promise.resolve() : new Promise(res => { img.onload = res; img.onerror = res; }))).then(() => {
                setTimeout(() => html2canvas(target, { scale: 2, backgroundColor: '#090314', useCORS: true, logging: false }).then(canvas => { resultImg.src = canvas.toDataURL("image/png"); loading.classList.add('hidden'); resultImg.classList.remove('hidden'); }), 400);
            });
        }

        function closeShareModal() { document.getElementById('share-modal').classList.add('hidden'); }
        
        // üéØ 4. ‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏π‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        function generateRandomItem() { 
            const rand = Math.random() * 100; 
            let cum = 0; 
            for (const [rank, rate] of Object.entries(currentBanner.rates)) { 
                cum += rate; 
                if (rand <= cum) { 
                    const pos = currentBanner.items.filter(i => i.rank === rank); 
                    return pos[Math.floor(Math.random() * pos.length)]; 
                } 
            } 
            return currentBanner.items[currentBanner.items.length - 1]; 
        }
        
        function startPullAnimation(pulls) {
            currentPullsToAnimate = pulls; isOverlayAnimating = true;
            const overlay = document.getElementById('pull-overlay'), container = document.getElementById('overlay-items-container'), actions = document.getElementById('overlay-actions'), skip = document.getElementById('overlay-skip-text');
            container.innerHTML = ''; actions.classList.add('hidden'); skip.classList.remove('hidden'); overlay.classList.remove('hidden'); overlay.classList.add('flex');
            let idx = 0; if (currentAnimationInterval) clearInterval(currentAnimationInterval);
            
            container.insertAdjacentHTML('beforeend', createOverlayItemHTML(pulls[idx])); idx++;
            if (idx >= pulls.length) setTimeout(endAnimation, 300);
            else { 
                currentAnimationInterval = setInterval(() => { 
                    if (idx >= pulls.length) { endAnimation(); return; } 
                    container.insertAdjacentHTML('beforeend', createOverlayItemHTML(pulls[idx])); idx++; 
                }, 150); 
            }
        }

        function endAnimation() {
            isOverlayAnimating = false; clearInterval(currentAnimationInterval);
            document.getElementById('overlay-actions').classList.remove('hidden'); document.getElementById('overlay-actions').classList.add('flex'); document.getElementById('overlay-skip-text').classList.add('hidden');
            if (isAutoPulling || currentPullsToAnimate.some(p => p.rank === 'SSR')) {
                const spk = document.getElementById('sparkle-overlay'); spk.classList.remove('hidden'); spk.classList.add('flex');
                setTimeout(() => { spk.classList.add('hidden'); spk.classList.remove('flex'); }, 1500);
            }
        }

        function finishAutoPull(gS) {
            isAutoPulling = false; isSpinning = false; isOverlayAnimating = false; if (pullTimeout) clearTimeout(pullTimeout); if (currentAnimationInterval) clearInterval(currentAnimationInterval);
            document.getElementById('egg-img').classList.remove('animate-bounce');
            document.getElementById('btn-pull-until-ssr').disabled = false;
            
            document.getElementById('total-pulls-text').innerText = totalPulls.toLocaleString(); 
            updateCost(); 
            updateLuckMeter(); 
            renderInventory(); 
            
            const ct = document.getElementById('overlay-pull-count-text'); const pr = (autoPullCount * (parseFloat(document.getElementById('price-per-pull').value) || 0)).toLocaleString();
            ct.innerHTML = `üéâ ‡∏≠‡∏≠‡∏Å SSR ‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà <span class="text-white text-2xl mx-1">${autoPullCount}</span><br><span class="text-xs font-normal text-slate-400">‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ ${pr} ‡∏ø</span>`;
            document.getElementById('overlay-actions').classList.remove('hidden'); document.getElementById('overlay-skip-text').classList.add('hidden');
            if (gS) { const s = document.getElementById('sparkle-overlay'); s.classList.remove('hidden'); s.classList.add('flex'); setTimeout(() => s.classList.add('hidden'), 1500); }
        }

        function handleOverlayClick(e) {
            if (e.target.closest('button')) return;
            if (isAutoPulling) { 
                let gS = false; 
                if (currentAnimationInterval) clearInterval(currentAnimationInterval);
                while (!gS && autoPullCount < 5000) { 
                    autoPullCount++; const nI = generateRandomItem(); history.push(nI); totalPulls++; if (nI.rank === 'SSR') gS = true; 
                }
                const lp = history.slice(-15); const cn = document.getElementById('overlay-items-container'); cn.innerHTML = ''; lp.forEach(i => cn.insertAdjacentHTML('beforeend', createOverlayItemHTML(i)));
                finishAutoPull(gS);
            } else if (isOverlayAnimating) { 
                clearInterval(currentAnimationInterval); 
                const cn = document.getElementById('overlay-items-container');
                for (let i = cn.children.length; i < currentPullsToAnimate.length; i++) {
                    cn.insertAdjacentHTML('beforeend', createOverlayItemHTML(currentPullsToAnimate[i]));
                }
                endAnimation(); 
            }
            else { if (!isSpinning) document.getElementById('pull-overlay').classList.add('hidden'); }
        }

        function pull(c, fO = false) {
            if (isSpinning) return; isSpinning = true; document.getElementById('overlay-pull-count-text').classList.add('hidden');
            if (!fO) { document.getElementById('btn-pull-until-ssr').disabled = true; document.getElementById('egg-img').classList.add('animate-bounce'); }
            const nP = []; for (let i = 0; i < c; i++) nP.push(generateRandomItem());
            pullTimeout = setTimeout(() => {
                history = [...nP, ...history]; totalPulls += c; isSpinning = false;
                if (!fO) { document.getElementById('btn-pull-until-ssr').disabled = false; document.getElementById('egg-img').classList.remove('animate-bounce'); }
                const ov = document.getElementById('pull-overlay'); ov.classList.remove('hidden'); ov.classList.add('flex');
                const cn = document.getElementById('overlay-items-container'); cn.innerHTML = ''; nP.forEach(i => cn.insertAdjacentHTML('beforeend', createOverlayItemHTML(i)));
                document.getElementById('overlay-actions').classList.remove('hidden'); document.getElementById('overlay-skip-text').classList.add('hidden');
                updateCost(); updateLuckMeter(); renderInventory();
                startPullAnimation(nP);
            }, fO ? 50 : 600);
        }

        function pullUntilSSR() {
            if (isSpinning) return; isSpinning = true; isAutoPulling = true; autoPullCount = 0;
            const ov = document.getElementById('pull-overlay'), cn = document.getElementById('overlay-items-container'), ct = document.getElementById('overlay-pull-count-text');
            document.getElementById('btn-pull-until-ssr').disabled = true; document.getElementById('egg-img').classList.add('animate-bounce');
            document.getElementById('overlay-actions').classList.add('hidden'); document.getElementById('overlay-skip-text').classList.remove('hidden'); 
            ct.classList.remove('hidden'); cn.innerHTML = ''; ov.classList.remove('hidden'); ov.classList.add('flex');
            currentAnimationInterval = setInterval(() => {
                if (!isAutoPulling) { clearInterval(currentAnimationInterval); return; }
                autoPullCount++; const nI = generateRandomItem(); history.push(nI); totalPulls++;
                if (cn.children.length >= 15) cn.innerHTML = ''; cn.insertAdjacentHTML('beforeend', createOverlayItemHTML(nI));
                ct.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà <span class="text-white text-xl mx-1">${autoPullCount}</span>`; updateCost();
                if (nI.rank === 'SSR' || autoPullCount >= 5000) { 
                    const isSSR = nI.rank === 'SSR';
                    clearInterval(currentAnimationInterval); 
                    finishAutoPull(isSSR); 
                }
            }, 150);
        }

        function renderInventory() {
            const section = document.getElementById('inventory-section'), container = document.getElementById('inventory-container'), emptyState = document.getElementById('empty-inventory-state');
            if (history.length === 0) { section.classList.add('hidden'); emptyState.classList.remove('hidden'); emptyState.classList.add('flex'); return; }
            section.classList.remove('hidden'); emptyState.classList.add('hidden'); emptyState.classList.remove('flex');
            const inventory = {}; history.forEach(item => { if (inventory[item.id]) inventory[item.id].totalCount += item.qty; else inventory[item.id] = { ...item, totalCount: item.qty }; });
            const rankOrder = { 'SSR': 1, 'SR': 2, 'R': 3, 'A': 4, 'B': 5, 'C': 6, 'E': 7 };
            const sortedItems = Object.values(inventory).sort((a, b) => rankOrder[a.rank] - rankOrder[b.rank]);
            let html = ''; sortedItems.forEach(item => {
                const style = RANK_STYLES[item.rank];
                let bgEffect = item.rank === 'SSR' ? `<div class="absolute inset-0 shimmer mix-blend-overlay pointer-events-none"></div>` : '';
                html += `<div class="${style.bg} border ${style.border} p-1.5 rounded-xl text-center flex flex-col items-center justify-between min-h-[90px] relative overflow-hidden shadow-sm">${bgEffect}<div class="absolute top-0.5 right-0.5 text-[8px] font-black px-1 py-0.5 rounded-md text-white bg-slate-900/80 shadow border border-slate-600 z-20">x${item.totalCount.toLocaleString()}</div><img src="${item.imgSrc}" alt="${item.name}" class="w-10 h-10 mt-3 z-10 object-contain mix-blend-multiply" crossorigin="anonymous" /><div class="z-10 w-full pb-0.5 relative"><p class="text-[8px] leading-tight line-clamp-2 ${style.text}">${item.name}</p></div></div>`;
            }); container.innerHTML = html;
        }

        function resetData() { history = []; totalPulls = 0; document.getElementById('total-pulls-text').innerText = '0'; updateCost(); updateLuckMeter(); renderInventory(); }
        window.onload = () => { preloadImages(); renderRates(); updateCost(); };
    </script>
</body>
</html>
